# ============================================================
# ОБНОВЛЕНИЕ И СБОРКА FRONTEND НА СЕРВЕРЕ
# ============================================================

# 1. Пулим исправление с GitHub
cd /opt/sofiya
git pull origin main

# 2. Переходим в frontend
cd frontend

# 3. Собираем frontend (теперь должно пройти БЕЗ ОШИБОК!)
npm run build

# 4. Запускаем через PM2
pm2 start npm --name frontend --cwd /opt/sofiya/frontend -- start

# 5. Проверяем логи
pm2 logs frontend --lines 20

# 6. Проверяем статус
pm2 list

# 7. Сохраняем PM2
pm2 save

# 8. Финальная проверка
curl http://localhost:8000/health
sleep 5
curl -I http://localhost:3000

# ============================================================
# ГОТОВО! v4.0.0 РАЗВЁРНУТА! 🚀
# ============================================================

# Должны быть оба сервиса online:
# ┌────┬────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
# │ id │ name       │ mode     │ ↺    │ status    │ cpu      │ memory   │
# ├────┼────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
# │ 0  │ backend    │ fork     │ 0    │ online    │ 0%       │ XX.Xmb   │
# │ 1  │ frontend   │ fork     │ 0    │ online    │ 0%       │ XX.Xmb   │
# └────┴────────────┴──────────┴──────┴───────────┴──────────┴──────────┘

