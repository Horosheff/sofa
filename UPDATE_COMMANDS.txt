═══════════════════════════════════════════════════════════════
🚀 КОМАНДЫ ДЛЯ ОБНОВЛЕНИЯ BACKEND НА СЕРВЕРЕ
═══════════════════════════════════════════════════════════════

📋 СПОСОБ 1: Копируй и вставь все команды сразу
───────────────────────────────────────────────────────────────

cd /opt/sofiya/backend && git pull origin main && sudo systemctl restart sofa-backend && sudo systemctl status sofa-backend --no-pager && sudo journalctl -u sofa-backend -n 20 --no-pager


═══════════════════════════════════════════════════════════════
📋 СПОСОБ 2: Команды по одной
───────────────────────────────────────────────────────────────

1. Перейти в директорию backend:
   cd /opt/sofiya/backend

2. Получить последние изменения:
   git pull origin main

3. Перезапустить backend:
   sudo systemctl restart sofa-backend

4. Проверить статус:
   sudo systemctl status sofa-backend

5. Посмотреть логи:
   sudo journalctl -u sofa-backend -n 30 --no-pager


═══════════════════════════════════════════════════════════════
📋 СПОСОБ 3: Через скрипт
───────────────────────────────────────────────────────────────

1. Загрузить скрипт на сервер:
   wget https://raw.githubusercontent.com/Horosheff/sofa/main/UPDATE_SERVER_NOW.sh

2. Запустить:
   bash UPDATE_SERVER_NOW.sh


═══════════════════════════════════════════════════════════════
🔍 ПРОВЕРКА ПОСЛЕ ОБНОВЛЕНИЯ
───────────────════════════════════════════════════════════════

1. Убедись, что backend запущен:
   sudo systemctl status sofa-backend

2. Проверь последние логи на ошибки:
   sudo journalctl -u sofa-backend -n 50 | grep -i error

3. Тестируй в ChatGPT:
   - wordstat_get_user_info
   - wordstat_get_regions_tree
   - wordstat_get_top_requests (phrase: "купить носки")
   - wordstat_get_regions (phrase: "купить носки", devices: ["desktop"])
   - wordstat_get_dynamics (phrase: "купить носки", period: "monthly", fromDate: "2024-01-01")


═══════════════════════════════════════════════════════════════
❌ ЕСЛИ ЧТО-ТО ПОШЛО НЕ ТАК
───────────────────────────────────────────────────────────────

1. Смотреть полные логи:
   sudo journalctl -u sofa-backend -f

2. Перезапустить принудительно:
   sudo systemctl stop sofa-backend
   sudo systemctl start sofa-backend

3. Проверить, что порт 8000 свободен:
   sudo lsof -i :8000

4. Если нужно убить процесс:
   sudo pkill -9 -f uvicorn


═══════════════════════════════════════════════════════════════
✅ ВСЁ РАБОТАЕТ!
───────────────────────────────────────────────────────────────

После обновления все 5 методов Wordstat API должны работать:

✅ wordstat_get_user_info - информация о пользователе
✅ wordstat_get_regions_tree - дерево регионов (исправлен!)
✅ wordstat_get_top_requests - топ запросов
✅ wordstat_get_regions - статистика по регионам (исправлен!)
✅ wordstat_get_dynamics - динамика запросов

═══════════════════════════════════════════════════════════════

