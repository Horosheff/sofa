#!/bin/bash

# üö® –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï MAIN.PY –ò–ó GIT
echo "üö® –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï MAIN.PY –ò–ó GIT"
echo "==============================="

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–∞–ø–∫—É
cd /opt/sofiya

# 1. –ü–†–û–í–ï–†–Ø–ï–ú –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï
echo "1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ..."
git status

# 2. –í–û–°–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú MAIN.PY –ò–ó GIT
echo "2Ô∏è‚É£ –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º main.py –∏–∑ Git..."
git checkout origin/main -- backend/app/main.py

# 3. –ü–†–û–í–ï–†–Ø–ï–ú –ß–¢–û –§–ê–ô–õ –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù
echo "3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ñ–∞–π–ª –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω..."
head -30 backend/app/main.py

# 4. –ü–†–û–í–ï–†–Ø–ï–ú –ß–¢–û –í –§–ê–ô–õ–ï –ï–°–¢–¨ –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï APP
echo "4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤ —Ñ–∞–π–ª–µ –µ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ app..."
grep -n "app = FastAPI" backend/app/main.py

# 5. –ü–†–û–í–ï–†–Ø–ï–ú –†–ê–ó–ú–ï–† –§–ê–ô–õ–ê
echo "5Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞..."
wc -l backend/app/main.py

# 6. –ü–ï–†–ï–ó–ê–ü–£–°–ö–ê–ï–ú BACKEND
echo "6Ô∏è‚É£ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º backend..."
pm2 restart backend

# 7. –ñ–î–ï–ú –ó–ê–ü–£–°–ö–ê
echo "7Ô∏è‚É£ –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞ backend..."
sleep 5

# 8. –ü–†–û–í–ï–†–Ø–ï–ú –°–¢–ê–¢–£–°
echo "8Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å..."
pm2 status

# 9. –ü–†–û–í–ï–†–Ø–ï–ú –õ–û–ì–ò
echo "9Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏..."
pm2 logs backend --lines 20

# 10. –¢–ï–°–¢–ò–†–£–ï–ú API
echo "üîü –¢–µ—Å—Ç–∏—Ä—É–µ–º API..."
curl -s https://mcp-kv.ru/mcp/tools | head -c 200
echo ""

echo ""
echo "üéØ MAIN.PY –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù –ò–ó GIT!"
echo "‚úÖ –§–∞–π–ª –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ origin/main"
echo "‚úÖ Backend –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω"
echo "‚úÖ –°–∞–π—Ç —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç"
echo ""
echo "üîç –¢–µ–ø–µ—Ä—å –∑–∞–π–¥–∏ –Ω–∞ —Å–∞–π—Ç –∏ –ø—Ä–æ–≤–µ—Ä—å!"
